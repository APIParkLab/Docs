---
sidebar_position: 4
---

# 上游

在 `APIPark`中，“上游”是指 API 请求最终被路由到的后端服务器或服务。上游通常包含处理 API 请求的实际业务逻辑、数据存储和应用程序。在 API 网关架构中，网关接收并处理来自客户端的请求，然后将这些请求转发到上游服务器进行具体处理，获取响应并返回给客户端。

配置上游是API开放平台中关键的一步，确保API请求能够正确路由到后端服务。上游配置涉及定义和管理目标地址、负载均衡策略、以及故障转移机制，以确保服务的高可用性和性能。

## 操作演示
### 配置上游

1. 选中需要配置的服务，进入服务内部页面。

![](images/2024-08-14/cf9e5cd3b52f3977f4e5503e01234a4e538d9d9c1433c2ed9294e7de4afd00e5.png)  

2. 点击 `上游`，进入上游配置页面。

![](images/2024-08-14/d570bc5e464539010e542ddc88602fbcd94d6dbc14d01809908a220d32341b91.png)  

3. 配置上游信息，配置完成后，点击`保存`。

![](images/2024-08-14/7dd546e21086267638ee1c14d83a42e3cc9ba0e88de8b82b6a3b85e7a1baa386.png)  

![](images/2024-08-14/772f53c2f1cadef9e666cb7135f2e79b2b90db23c76bfdcc23e819425619d395.png)  

**字段说明**

<table><thead><tr><th width="169">字段名</th><th>说明</th></tr></thead><tbody><tr><td>上游类型</td><td>上游服务的类型，目前仅支持<code>静态上游，即有固定IP/域名+端口号的上游入口的服务。</code></td></tr><tr><td>服务地址</td><td>上游服务访问地址，可填写多个上游地址，并配置每个上游服务的权重。</td></tr><tr><td>请求协议</td><td>请求上游服务的协议，目前仅支持HTTP/HTTPS。</td></tr><tr><td>负载均衡</td><td>负载均衡算法，当前支持带权轮询、IP Hash。</td></tr><tr><td>转发Host</td><td>请求上游服务时，使用的Host值，此处有三个选项：<br/><br/><b>透传客户端请求Host：</b><br/>这种策略下，网关或代理服务器不会修改请求中的Host头信息。它将客户端（发起请求的一方）原始的Host头直接传递给上游服务（即实际提供服务的服务器）。 <br/>这允许上游服务识别请求的原始来源域名，从而可以根据原始请求的Host头提供定制化的内容或执行特定的逻辑。<br/><br/><b>使用上游服务Host：</b><br/><br/>这种策略中，网关或代理服务器会用配置好的一个或多个上游服务的Host头来替换原始请求中的Host头。 <br/>这通常用于将请求路由到特定的后端服务，而不管客户端请求中的Host头是什么。这可以简化上游服务的配置，因为它们不需要关心进入请求的Host头信息。<br/><br/><b>重写Host：</b><br/><br/>这种策略涉及到修改请求中的Host头，将其更改为特定的值。 这可以用于多种情况，比如当需要将请求路由到一个不同的域名，或者当需要确保请求符合特定的格式或安全要求时。 <br/>重写Host头可以提供更大的灵活性，但也可能导致一些意外的行为，特别是如果客户端依赖于原始Host头来进行某些操作时。</td></tr><tr><td>超时时间</td><td>请求上游超时时间，单位为ms。</td></tr><tr><td>超时重试次数</td><td>允许超时时，重新请求上游的次数，重试时，若上游配置多个服务地址，则网关会重新请求未请求过的服务地址。</td></tr><tr><td>调用频率限制</td><td>当前上游每秒允许请求的次数。</td></tr><tr><td>转发上游请求头</td><td>当请求上游时，需要增加或删除的请求头部信息，若不配置，网关会原封不动将请求头部转发给上游服务。</td></tr></tbody></table>

填写完后，点击`保存`即可。

